<!DOCTYPE html>
<html>
<head>
 <title>Learning CSS</title>

 <meta charset="utf-8" />
 <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1" />
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js">
 </script>
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
 <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
 <link rel="stylesheet" href="formcss.css">
</head>
<body>
	<header>
		<div class="fixedwidth">
			<div id="formdiv">
				<form method="get" action='#' id="signinform">
					<div class="group">
						<input id="username" autocomplete="off" type="text" name="username" required />
						<label for="username">Email or username</label>
						<span class="bar"></span>
						<div class="errorbar"></div>
						<p class="errormess">Sorry, that username's too short. It needs to be at least two characters.</p>
						<p id="errormess2">Something's missing. Please check and try again.</p>
					</div>
					
					<button type="submit" form="signinform" id="signin">Sign in</button>
				</form>
			</div>
		</div>
	</header>

<!--
<script src="form.js"></script>
-->

<script>
var kusercheck = false;
var userok = false;
var emailcheck = /^[\w\-\.\+]+\@[a-zA-Z0-9\.\-]+\.[a-zA-z0-9]{2,4}$/;


$(document).ready(function(){
	$(document).on("keypress", "form", function(event) { 
    	return event.keyCode != 13;
	});	
	$("#signinform").on("submit", function() {
		if(userok) {
			console.log("form ok");
			return true;
		} else {
			return false;
		}
	});

	$("input").on("keyup", function() {
		if($(this).attr("id") == "username" && kusercheck == false) {
			kusercheck = true
			console.log(kusercheck);
		} 
		if($(this).attr("id") == "username" && $("#username").val().indexOf("@") != -1) {
    		if((emailcheck.test($("#username").val()))) {	
    			$("#username").siblings('#errormess2').css("display", "none");
		    	$("#username").siblings(".errormess").css("display", "none");
		    	$("#username").siblings(".errorbar").css("display", "none");
		    	userok = true;
		    }
	    	console.log("valid email");
	    } else if( $(this).attr("id") == "username" && $("#username").val().length > 1) {
    		$("#username").siblings("#errormess2").css("display", "none");
    		$("#username").siblings(".errormess").css("display", "none");
    		$("#username").siblings(".errorbar").css("display", "none");
    		console.log("check username length");
    		userok = true;
    	}
	});
	

    $("input").on('blur', function(){
    	var a = $(this).attr("id");
    	var l = $(this).val().length;
    	//hasAmp = patt1.test($("#username").val());

    	if(l === 0 && a == "username" && kusercheck)  {
			$("#username").siblings("#errormess2").text("Something's missing. Please check and try again.").css("display", "block");
			$("#username").siblings(".errormess").css("display", "none");
			$("#username").siblings(".errorbar").css("display", "block");
			console.log("check blur kusercheck");
			userok = false;
		} else if(a == "username" && $("#username").val().indexOf("@") != -1) {
    		if(!(emailcheck.test($("#username").val()))) {
	    		$("#username").siblings("#errormess2").text("Sorry, that doesn't look right. Please check it's a proper email.").css("display", "block");
	    		$("#username").siblings(".errormess").css("display", "none");
	    		$("#username").siblings(".errorbar").css("display", "block");
	    		console.log("blur not valid email");
	    		userok = false;
    		} else {
    			console.log("blur valid email");
    			userok = true;
    		}
    	} else if(l == 0) {
    		//do nothing
    	} else if(l == 1) {
    		if(a == "username") {
	    		$("#username").siblings('#errormess2').css("display", "none");
	    		$("#username").siblings(".errormess").css("display", "block");
	    		$("#username").siblings(".errorbar").css("display", "block");
	    		console.log("blur display username field if length 1")
	    		userok = false;
	    	} 
	    } 
    });    	
});


</script>


</body>
</html>
                